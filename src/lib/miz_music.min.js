/*!
 * miz_music
 * Copyright (c) 2015 MizunagiKB
 * https://github.com/MizunagiKB/miz_music
 * license MIT
 */

import Encoding from 'encoding-japanese';

/*miz_music.min.js*/
export let miz;!function(E){!function(E){!function(E){E[E.NOTE_OF=128]="NOTE_OF",E[E.NOTE_ON=144]="NOTE_ON",E[E.P_AFTER_TOUCH=160]="P_AFTER_TOUCH",E[E.CONTROL_CHANGE=176]="CONTROL_CHANGE",E[E.PROGRAM_CHANGE=192]="PROGRAM_CHANGE",E[E.C_AFTER_TOUCH=208]="C_AFTER_TOUCH",E[E.PITCH=224]="PITCH",E[E.SYS_EX_F0=240]="SYS_EX_F0",E[E.SYS_EX_F7=247]="SYS_EX_F7",E[E.META_EVT=255]="META_EVT"}(E.E_MIDI_MSG||(E.E_MIDI_MSG={}));E.E_MIDI_MSG;!function(E){E[E.SEQUENCE_NUMBER=0]="SEQUENCE_NUMBER",E[E.TEXT=1]="TEXT",E[E.COPYRIGHT=2]="COPYRIGHT",E[E.TRACK_NAME=3]="TRACK_NAME",E[E.INSTRUMENT_NAME=4]="INSTRUMENT_NAME",E[E.LYRIC=5]="LYRIC",E[E.MARKER=6]="MARKER",E[E.CUE=7]="CUE",E[E.END_OF_TRACK=47]="END_OF_TRACK",E[E.TEMPO=81]="TEMPO",E[E.SMPTE_OFFSET=84]="SMPTE_OFFSET",E[E.TIME_SIGNATURE=88]="TIME_SIGNATURE",E[E.KEY_SIGNATURE=89]="KEY_SIGNATURE",E[E.SEQUENCER_SPECIFIC_META_EVT=127]="SEQUENCER_SPECIFIC_META_EVT"}(E.E_META_EVT||(E.E_META_EVT={}));E.E_META_EVT;var _=function(){return function(){this.m_nStep=0,this.m_eMMsg=0,this.m_eMEvt=0,this.m_aryValue=[],this.m_numValue=0,this.m_strValue=""}}();E.CMIDIData=_;var T=function(){return function(){this.m_listData=[]}}();E.CMIDITrack=T;var M=function(){return function(){this.m_nTimeDiv=480,this.m_strTitle="",this.m_listTrack=[]}}();E.CMIDIMusic=M}(E.music||(E.music={}))}(miz||(miz={}));

/*miz_music_conv.min.js*/
let E_EXTRACT_TYPE;!function(_){_[_.E_EXTRACT_TYPE_I16_LE=0]="E_EXTRACT_TYPE_I16_LE",_[_.E_EXTRACT_TYPE_U16_LE=1]="E_EXTRACT_TYPE_U16_LE",_[_.E_EXTRACT_TYPE_I16=2]="E_EXTRACT_TYPE_I16",_[_.E_EXTRACT_TYPE_U16=3]="E_EXTRACT_TYPE_U16",_[_.E_EXTRACT_TYPE_I32=4]="E_EXTRACT_TYPE_I32"}(E_EXTRACT_TYPE||(E_EXTRACT_TYPE={}));var CMusicParser=function(){function _(_){this.m_aryData=new Uint8Array(_)}return _.prototype.extract_number=function(_,E){var T=0;switch(_){case E_EXTRACT_TYPE.E_EXTRACT_TYPE_I16_LE:case E_EXTRACT_TYPE.E_EXTRACT_TYPE_U16_LE:T|=this.m_aryData[E+0],T|=this.m_aryData[E+1]<<8,_==E_EXTRACT_TYPE.E_EXTRACT_TYPE_I16_LE&&0!=(4096&T)&&(T-=65536);break;case E_EXTRACT_TYPE.E_EXTRACT_TYPE_I16:case E_EXTRACT_TYPE.E_EXTRACT_TYPE_U16:T|=this.m_aryData[E+0]<<8,T|=this.m_aryData[E+1],_==E_EXTRACT_TYPE.E_EXTRACT_TYPE_I16&&0!=(4096&T)&&(T-=65536);break;case E_EXTRACT_TYPE.E_EXTRACT_TYPE_I32:T|=this.m_aryData[E+0]<<24,T|=this.m_aryData[E+1]<<16,T|=this.m_aryData[E+2]<<8,T|=this.m_aryData[E+3]}return T},_.prototype.extract_string=function(_,E){console.assert(_>=0),console.assert(E>=1),console.assert(_<this.m_aryData.length),console.assert(_+E<this.m_aryData.length);for(var T="",a=_;a<_+E;a++)T+=String.fromCharCode(this.m_aryData[a]);return T},_}();

/*miz_music_conv_rcp.min.js*/
let __extends=this&&this.__extends||function(a,t){for(var _ in t)t.hasOwnProperty(_)&&(a[_]=t[_]);function r(){this.constructor=a}a.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},CExc=function(){function a(a,t,_){void 0===a&&(a=null),void 0===t&&(t=0),void 0===_&&(_=0),this.m_oRCPStep=null,this.m_aryData=[],this.m_nStep=0,this.m_nSequence=0,this.m_nCh=0,this.m_nGate=0,this.m_nVelo=0,this.set_param(a,t,_)}return a.prototype.set_param=function(a,t,_){null!=a&&(this.m_nCh=a.m_nCh,this.m_nStep=a.m_nStepTotal,this.m_nSequence=a.m_nSequence),this.m_nGate=t,this.m_nVelo=_},a.prototype.build=function(){for(var a=0,t=[],_=null,r=0;r<this.m_aryData.length;r++){var e=this.m_aryData[r];if(247==e){t.length;t.push(247),t.unshift(240);break}switch(e){case 128:t.push(this.m_nGate),a+=this.m_nGate;break;case 129:t.push(this.m_nVelo),a+=this.m_nVelo;break;case 130:t.push(this.m_nCh),a+=this.m_nCh;break;case 131:a=0;break;case 132:t.push(128-(127&a));break;default:t.push(e),a+=e}}return(_=new CRCPStep).m_nStep=this.m_nStep,_.m_nSequence=this.m_nSequence,_.m_oCMIDIData=new miz.music.CMIDIData,_.m_oCMIDIData.m_eMMsg=miz.music.E_MIDI_MSG.SYS_EX_F0,_.m_oCMIDIData.m_eMEvt=0,_.m_oCMIDIData.m_aryValue=t,_},a}(),CExcRoland=function(a){function t(){a.apply(this,arguments),this.m_nDevice=0,this.m_nModel=0,this.m_nBaseAddr1=0,this.m_nBaseAddr2=0,this.m_nOffset=0,this.m_nParam=0}return __extends(t,a),t.prototype.build=function(){return this.m_aryData=[],this.m_aryData.push(65),this.m_aryData.push(this.m_nDevice),this.m_aryData.push(this.m_nModel),this.m_aryData.push(18),this.m_aryData.push(131),this.m_aryData.push(this.m_nBaseAddr1),this.m_aryData.push(this.m_nBaseAddr2),this.m_aryData.push(this.m_nOffset),this.m_aryData.push(this.m_nParam),this.m_aryData.push(132),this.m_aryData.push(247),a.prototype.build.call(this)},t}(CExc),CRCPTrackWork=function(){function a(){this.m_nCh=0,this.m_nTrackSize=0,this.m_nTrackAddr=0,this.m_nStepTotal=0,this.m_nStepBreak=0,this.m_nSequence=0,this.m_nPos=0}return a.prototype.create_copy=function(){var t=new a;return t.m_nCh=this.m_nCh,t.m_nTrackSize=this.m_nTrackSize,t.m_nTrackAddr=this.m_nTrackAddr,t.m_nStepTotal=this.m_nStepTotal,t.m_nStepBreak=this.m_nStepBreak,t.m_nSequence=this.m_nSequence,t.m_nPos=this.m_nPos,t},a}(),CRCPStep=function(){function a(){this.m_nStep=0,this.m_nSequence=0,this.m_oCMIDIData=null}return a.prototype.ary_print=function(){for(var a=0;a<this.m_oCMIDIData.m_aryValue.length;a++)" "+this.m_oCMIDIData.m_aryValue[a].toString(16)},a}(),CRCPLoop=function(){return function(){this.m_nPos=0,this.m_nCount=0}}(),CMusicParserRCP=function(){function a(a){this.m_listCExc=[],this.m_nPos=0,this.m_oCParser=a,this.m_nPos=0}return a.prototype.convert_track=function(a){for(var t=new miz.music.CMIDITrack,_=0,r=[],e=0;e<128;e++)r.push(0);for(e=0;e<a.length;e++){var s=a[e];switch(s.m_oCMIDIData.m_eMMsg){case miz.music.E_MIDI_MSG.NOTE_ON:var m=s.m_oCMIDIData.m_aryValue[1];if(0==s.m_oCMIDIData.m_aryValue[2]){if(1==r[m])(n=s.m_oCMIDIData).m_nStep=s.m_nStep-_,t.m_listData.push(n),s.m_nStep>_&&(_=s.m_nStep);r[m]-=1}else{if(0==r[m])(n=s.m_oCMIDIData).m_nStep=s.m_nStep-_,t.m_listData.push(n),s.m_nStep>_&&(_=s.m_nStep);r[m]+=1}break;default:var n;(n=s.m_oCMIDIData).m_nStep=s.m_nStep-_,t.m_listData.push(n),s.m_nStep>_&&(_=s.m_nStep)}}return t},a.prototype.build_num=function(a,t,_,r){var e=null,s=null;return(s=new miz.music.CMIDIData).m_nStep=0,s.m_eMMsg=t,s.m_eMEvt=_,s.m_numValue=r,(e=new CRCPStep).m_nStep=a.m_nStepTotal,e.m_nSequence=a.m_nSequence,e.m_oCMIDIData=s,a.m_nSequence++,e},a.prototype.build_array=function(a,t,_,r){var e=null,s=null;return(s=new miz.music.CMIDIData).m_nStep=0,s.m_eMMsg=t,s.m_eMEvt=_,s.m_aryValue=r,(e=new CRCPStep).m_nStep=a.m_nStepTotal,e.m_nSequence=a.m_nSequence,e.m_oCMIDIData=s,a.m_nSequence++,e},a.prototype.build_note=function(a,t,_,r){var e=[];if(_>0){var s=null;(s=this.build_array(a,miz.music.E_MIDI_MSG.NOTE_ON,0,[144+a.m_nCh,t,r])).m_nStep=a.m_nStepTotal,e.push(s),(s=this.build_array(a,miz.music.E_MIDI_MSG.NOTE_ON,0,[144+a.m_nCh,t,0])).m_nStep=a.m_nStepTotal+_,e.push(s)}return e},a.prototype.copy_event=function(a,t,_){var r,e=a.create_copy();return e.m_nPos=_-44,e.m_nStepBreak=e.m_nStepTotal+this.m_nStepBlock,r=this.make_event(e,!0),a.m_nStepTotal=e.m_nStepTotal,a.m_nSequence=e.m_nSequence,r},a.prototype.make_event=function(a,t){for(var _=[],r=[],e=a.m_nPos,s=!1,m=null;e<a.m_nTrackSize;){var n=e+a.m_nTrackAddr,i=0,h=this.m_oCParser.m_aryData[n+0];if(h<128)array_append(_,this.build_note(a,this.m_oCParser.m_aryData[n+0],this.m_oCParser.m_aryData[n+2],this.m_oCParser.m_aryData[n+3])),i=this.m_oCParser.m_aryData[n+1];else switch(h){case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:(o=this.m_listCExc[h-144]).set_param(a,this.m_oCParser.m_aryData[n+2],this.m_oCParser.m_aryData[n+3]),_.push(o.build()),i=this.m_oCParser.m_aryData[n+1];break;case 152:m=new CExc(a,this.m_oCParser.m_aryData[n+2],this.m_oCParser.m_aryData[n+3]),i=this.m_oCParser.m_aryData[n+1];break;case 153:i=0;break;case 221:var o=m;console.assert(null!=m),o.m_nBaseAddr1=this.m_oCParser.m_aryData[n+2],o.m_nBaseAddr2=this.m_oCParser.m_aryData[n+3],i=this.m_oCParser.m_aryData[n+1];break;case 222:o=m;console.assert(null!=m),o.m_nOffset=this.m_oCParser.m_aryData[n+2],o.m_nParam=this.m_oCParser.m_aryData[n+3],o.set_param(a,this.m_oCParser.m_aryData[n+2],this.m_oCParser.m_aryData[n+3]),_.push(o.build()),i=this.m_oCParser.m_aryData[n+1];break;case 223:(o=new CExcRoland(a,this.m_oCParser.m_aryData[n+2],this.m_oCParser.m_aryData[n+3])).m_nDevice=this.m_oCParser.m_aryData[n+2],o.m_nModel=this.m_oCParser.m_aryData[n+3],m=o,i=this.m_oCParser.m_aryData[n+1];break;case 226:var u=null,c=null;_.push(this.build_array(a,miz.music.E_MIDI_MSG.CONTROL_CHANGE,0,[176+a.m_nCh,0,this.m_oCParser.m_aryData[n+3]])),_.push(this.build_array(a,miz.music.E_MIDI_MSG.CONTROL_CHANGE,0,[176+a.m_nCh,32,0])),_.push(this.build_array(a,miz.music.E_MIDI_MSG.PROGRAM_CHANGE,0,[192+a.m_nCh,this.m_oCParser.m_aryData[n+2]])),i=this.m_oCParser.m_aryData[n+1];break;case 231:var p=this.m_nTempo*this.m_oCParser.m_aryData[n+2]/64;_.push(this.build_num(a,miz.music.E_MIDI_MSG.META_EVT,miz.music.E_META_EVT.TEMPO,Math.floor(6e7/p))),i=this.m_oCParser.m_aryData[n+1];break;case 234:_.push(this.build_array(a,miz.music.E_MIDI_MSG.C_AFTER_TOUCH,0,[208+a.m_nCh,this.m_oCParser.m_aryData[n+2]])),i=this.m_oCParser.m_aryData[n+1];break;case 235:_.push(this.build_array(a,miz.music.E_MIDI_MSG.CONTROL_CHANGE,0,[176+a.m_nCh,this.m_oCParser.m_aryData[n+2],this.m_oCParser.m_aryData[n+3]])),i=this.m_oCParser.m_aryData[n+1];break;case 236:_.push(this.build_array(a,miz.music.E_MIDI_MSG.PROGRAM_CHANGE,0,[192+a.m_nCh,this.m_oCParser.m_aryData[n+2]])),i=this.m_oCParser.m_aryData[n+1];break;case 237:_.push(this.build_array(a,miz.music.E_MIDI_MSG.P_AFTER_TOUCH,0,[160+a.m_nCh,this.m_oCParser.m_aryData[n+2],this.m_oCParser.m_aryData[n+3]])),i=this.m_oCParser.m_aryData[n+1];break;case 238:u=null,c=null;(u=new miz.music.CMIDIData).m_nStep=0,u.m_eMMsg=miz.music.E_MIDI_MSG.PITCH,u.m_aryValue=[224+a.m_nCh,this.m_oCParser.m_aryData[n+2],this.m_oCParser.m_aryData[n+3]],(c=new CRCPStep).m_nStep=a.m_nStepTotal,c.m_nSequence=a.m_nSequence,c.m_oCMIDIData=u,a.m_nSequence++,_.push(c),i=this.m_oCParser.m_aryData[n+1];break;case 245:case 246:i=0;break;case 247:if(null!=m)for(var C=2;C<4;C++){var D=this.m_oCParser.m_aryData[n+C];if(m.m_aryData.push(D),247==D){_.push(m.build()),m=null;break}}i=0;break;case 248:if(null==(l=r.pop()).m_nCount){var y=this.m_oCParser.m_aryData[n+1];l.m_nCount=0==y?2:this.m_oCParser.m_aryData[n+1]}else l.m_nCount-=1;l.m_nCount>1&&(e=l.m_nPos,r.push(l)),i=0;break;case 249:var l;(l=new CRCPLoop).m_nPos=e,l.m_nCount=null,r.push(l),i=0;break;case 252:var P=0,S=0;P|=this.m_oCParser.m_aryData[n+1],P|=(3&this.m_oCParser.m_aryData[n+2])<<8,S|=this.m_oCParser.m_aryData[n+3]<<8,S|=252&this.m_oCParser.m_aryData[n+2],_=array_append(_,this.copy_event(a,P,S)),i=0;break;case 253:s=!0,i=0;break;case 254:i=0;break;default:i=this.m_oCParser.m_aryData[n+1]}if(e+=4,a.m_nStepTotal+=i,1==t&&1==s)break}return _},a.prototype.parse_track=function(a,t,_){var r=null,e=[],s=new CRCPTrackWork;return s.m_nCh=a,s.m_nTrackSize=_,s.m_nStepTotal=t,s.m_nSequence=256,s.m_nTrackAddr=this.m_nPos,s.m_nPos=0,e=this.make_event(s,!1),(r=this.build_num(s,miz.music.E_MIDI_MSG.META_EVT,miz.music.E_META_EVT.TEMPO,Math.floor(6e7/this.m_nTempo))).m_nStep=0,r.m_nSequence=0,e.unshift(r),e.sort(function(a,t){return a.m_nStep==t.m_nStep?a.m_nSequence-t.m_nSequence:a.m_nStep-t.m_nStep}),this.convert_track(e)},a.prototype.parse_head=function(){var a=!1;switch(this.m_oCParser.extract_string(0,2)){case"RC":a=!0}if(1==a){this.m_nTimeDiv=0,this.m_nTimeDiv|=this.m_oCParser.m_aryData[448]<<0,this.m_nTimeDiv|=this.m_oCParser.m_aryData[487]<<8,this.m_nTempo=this.m_oCParser.m_aryData[449],this.m_nBeat_Nume=this.m_oCParser.m_aryData[450],this.m_nBeat_Deno=this.m_oCParser.m_aryData[451],this.m_nStepBlock=this.m_nBeat_Nume*this.m_nTimeDiv,this.m_nKey=this.m_oCParser.m_aryData[452],this.m_nBias=this.m_oCParser.m_aryData[453],this.m_nTrk=this.m_oCParser.m_aryData[486],0==this.m_nTrk&&(this.m_nTrk=36),this.m_strTitle=Encoding.convert(this.m_oCParser.extract_string(32,64),{to:"UNICODE",type:"string"});for(var t=0;t<8;t++){Encoding.convert(this.m_oCParser.extract_string(1030+48*t,24),{to:"UNICODE",type:"string"});for(var _=new CExc,r=0;r<24;r++)_.m_aryData.push(this.m_oCParser.m_aryData[1030+48*t+24+r]);_.m_aryData.push(247),this.m_listCExc.push(_)}}return a},a.prototype.parse=function(){var a=null;if(1==this.parse_head()){this.m_nPos=1414,a=new miz.music.CMIDIMusic;for(var t=0;t<this.m_nTrk;t++){var _=this.m_oCParser.extract_number(E_EXTRACT_TYPE.E_EXTRACT_TYPE_U16_LE,this.m_nPos+0),r=(this.m_oCParser.m_aryData[this.m_nPos+2],this.m_oCParser.m_aryData[this.m_nPos+3],this.m_oCParser.m_aryData[this.m_nPos+4]),e=(this.m_oCParser.m_aryData[this.m_nPos+5],this.m_oCParser.m_aryData[this.m_nPos+6]),s=this.m_oCParser.m_aryData[this.m_nPos+7],m=this.m_nPos+_;if(this.m_nPos+=44,0==s&&r<16&&a.m_listTrack.push(this.parse_track(r,e,_-44)),this.m_nPos=m,!(this.m_nPos<this.m_oCParser.m_aryData.length))break}a.m_nTimeDiv=this.m_nTimeDiv,a.m_strTitle=this.m_strTitle}return a},a}();function array_append(a,t){for(var _=0;_<t.length;_++)a.push(t[_]);return a}

/*miz_music_conv_smf.min.js*/
let CMusicParserSMF=function(){function s(s){this.m_oCParser=s,this.m_nPos=0}return s.prototype.decode_dvalue=function(){for(var s=0,_=0;_<<=7,_|=127&(s=this.m_oCParser.m_aryData[this.m_nPos]),this.m_nPos+=1,!(s<128););return _},s.prototype.decode_message_ev_std=function(s){var _=240&s,t=null;switch(_){case miz.music.E_MIDI_MSG.NOTE_OF:case miz.music.E_MIDI_MSG.NOTE_ON:case miz.music.E_MIDI_MSG.P_AFTER_TOUCH:case miz.music.E_MIDI_MSG.CONTROL_CHANGE:(t=new miz.music.CMIDIData).m_nStep=this.m_nStep,t.m_eMMsg=_,t.m_aryValue=[s,this.m_oCParser.m_aryData[this.m_nPos+0],this.m_oCParser.m_aryData[this.m_nPos+1]],this.m_nPos+=2;break;case miz.music.E_MIDI_MSG.PROGRAM_CHANGE:case miz.music.E_MIDI_MSG.C_AFTER_TOUCH:(t=new miz.music.CMIDIData).m_nStep=this.m_nStep,t.m_eMMsg=_,t.m_aryValue=[s,this.m_oCParser.m_aryData[this.m_nPos+0]],this.m_nPos+=1;break;case miz.music.E_MIDI_MSG.PITCH:(t=new miz.music.CMIDIData).m_nStep=this.m_nStep,t.m_eMMsg=_,t.m_aryValue=[s,this.m_oCParser.m_aryData[this.m_nPos+0],this.m_oCParser.m_aryData[this.m_nPos+1]],this.m_nPos+=2;break;default:console.log("err std:"+s),console.log(this.m_nPos),console.assert(!1)}return t},s.prototype.decode_message_ev_met=function(s){var _=null;switch(s){case miz.music.E_MIDI_MSG.SYS_EX_F0:var t=this.decode_dvalue();(_=new miz.music.CMIDIData).m_nStep=this.m_nStep,_.m_aryValue=[240],_.m_eMMsg=s;for(var e=0;e<t;e++)_.m_aryValue.push(this.m_oCParser.m_aryData[this.m_nPos+e]);this.m_nPos+=t;break;case miz.music.E_MIDI_MSG.SYS_EX_F7:t=this.decode_dvalue();(_=new miz.music.CMIDIData).m_nStep=this.m_nStep,_.m_aryValue=[],_.m_eMMsg=s;for(e=0;e<t;e++)_.m_aryValue.push(this.m_oCParser.m_aryData[this.m_nPos+e]);this.m_nPos+=t;break;case miz.music.E_MIDI_MSG.META_EVT:var m=this.m_oCParser.m_aryData[this.m_nPos];this.m_nPos+=1;t=this.decode_dvalue();switch(m){case 1:case 2:case 3:case 4:case 5:case 6:case 7:var a=this.m_oCParser.m_aryData.subarray(this.m_nPos,this.m_nPos+t);(_=new miz.music.CMIDIData).m_nStep=this.m_nStep,_.m_eMMsg=s,_.m_eMEvt=m,_.m_strValue=Encoding.convert(a,{to:"UNICODE",type:"string"}),m==miz.music.E_META_EVT.TRACK_NAME&&""==this.m_strTitle&&(this.m_strTitle=_.m_strValue),this.m_nPos+=t;break;case miz.music.E_META_EVT.END_OF_TRACK:this.m_nPos+=t;break;case miz.music.E_META_EVT.TEMPO:var r=0;r|=this.m_oCParser.m_aryData[this.m_nPos+0]<<16,r|=this.m_oCParser.m_aryData[this.m_nPos+1]<<8,r|=this.m_oCParser.m_aryData[this.m_nPos+2],this.m_nPos+=t,(_=new miz.music.CMIDIData).m_nStep=this.m_nStep,_.m_eMMsg=s,_.m_eMEvt=m,_.m_numValue=r;break;default:this.m_nPos+=t,(_=new miz.music.CMIDIData).m_nStep=this.m_nStep,_.m_eMMsg=s,_.m_eMEvt=m}break;default:console.log("err met:"+s),console.log(this.m_nPos),console.assert(!1)}return _},s.prototype.decode_message=function(){var s=this.m_oCParser.m_aryData[this.m_nPos],_=null;return s<128?_=this.m_nCurrentEv<240?this.decode_message_ev_std(this.m_nCurrentEv):this.decode_message_ev_met(this.m_nCurrentEv):s<240?(this.m_nPos+=1,this.m_nCurrentEv=s,_=this.decode_message_ev_std(this.m_nCurrentEv)):(this.m_nPos+=1,_=this.decode_message_ev_met(s)),_},s.prototype.parse_MThd=function(){var s=!1;return"MThd"==this.m_oCParser.extract_string(0,4)&&(this.m_oCParser.extract_number(E_EXTRACT_TYPE.E_EXTRACT_TYPE_I32,4),this.m_nFmt=this.m_oCParser.extract_number(E_EXTRACT_TYPE.E_EXTRACT_TYPE_U16,8),this.m_nTrk=this.m_oCParser.extract_number(E_EXTRACT_TYPE.E_EXTRACT_TYPE_U16,10),this.m_nTimeDiv=this.m_oCParser.extract_number(E_EXTRACT_TYPE.E_EXTRACT_TYPE_U16,12),this.m_strTitle="",s=!0),s},s.prototype.parse_MTrk=function(){var s=new miz.music.CMIDITrack,_=null;this.m_oCParser.extract_string(this.m_nPos,4),this.m_nPos+=4;var t=this.m_oCParser.extract_number(E_EXTRACT_TYPE.E_EXTRACT_TYPE_I32,this.m_nPos);this.m_nPos+=4;var e=this.m_nPos;for(this.m_nStep=0;this.m_nStep=this.decode_dvalue(),null!=(_=this.decode_message());)s.m_listData.push(_);return this.m_nPos=e+t,s},s.prototype.parse=function(){var s=null,_=null;this.m_oCParser.m_aryData.length;if(1==this.parse_MThd()){this.m_nPos+=14,s=new miz.music.CMIDIMusic;for(var t=0;t<this.m_nTrk;t++)this.m_nCurrentEv=null,_=this.parse_MTrk(),s.m_listTrack.push(_);s.m_nTimeDiv=this.m_nTimeDiv,s.m_strTitle=this.m_strTitle}return s},s}();

export function music_reader (_) {var E=new CMusicParser(_),T=new CMusicParserSMF(E),a=new CMusicParserRCP(E),r=null;return null==(r=T.parse())&&(r=a.parse()),r};